var diciplinasRules = {};

var init = function() {
    setDisciplinasLista();
    setPeriods();
    report();
};

var setDisciplinasLista = function() {
    diciplinasRules.linguaPortuguesaEF = [15389, 15390, 15388, 15387];
    diciplinasRules.gramaticaEF = [8484, 8497, 8511, 8527];
    diciplinasRules.redacaoEF = [8480, 8493, 8507, 8521];
    
    diciplinasRules.matematicaEF = [13137, 13151];
    diciplinasRules.algebraEF = [8504, 8518];
    diciplinasRules.geometriaEF = [8505, 8519];
    
    diciplinasRules.cienciasEF = [13152];
    diciplinasRules.biologiaQuimicaEF = [8523];
    diciplinasRules.fisicaEF = [8526];
    
    diciplinasRules.leituraEF = [8486, 8499, 8513, 8529];
    
    diciplinasRules.linguaPortuguesaEM = [13157, 13158, 13163];
    diciplinasRules.gramaticaEM = [8416, 8429, 8440];
    diciplinasRules.redacaoEM = [8417, 8428, 8441];
    
    diciplinasRules.matematicaEM = [13153, 13159, 13164];
    diciplinasRules.matematicaIEM = [8321, 8420, 8444];
    diciplinasRules.matematicaIIEM = [8322, 8421, 8445];
    
    diciplinasRules.biologiaEM = [13154, 13160, 13165];
    diciplinasRules.biologiaIEM = [8328, 8431, 8451];
    diciplinasRules.biologiaIIEM = [8329, 8432, 8452];
    
    diciplinasRules.quimicaEM = [13156, 13162, 13167];
    diciplinasRules.quimicaIEM = [8317, 8424, 8442];
    diciplinasRules.quimicaIIEM = [8318, 8425, 8443];
    
    diciplinasRules.fisicaEM = [13155, 13161, 13166];
    diciplinasRules.fisicaIEM = [8319, 8426, 8449];
    diciplinasRules.fisicaIIEM = [8320, 8427, 8450];
}


var setPeriods = function() {
    data.periodos = [];
    setPrimeiroBimestre();
    setSegundoBimestre();
    setAtualidade();
    setPrimeiroTrimestre();
    setTerceiroBimestre();
    setQuartoBimestre();
    setMediaAnual();
    setMediaFinal();
    setSubtitleColumn();
};

var setPrimeiroBimestre = function() {
    var period = getPeriod(4537);
    var columns = [];
    columns.push(createColumn('Média', 'M', period));
    columns.push(createColumn('Faltas', 'F', period));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 1, 1, 1, columns));
};

var setSegundoBimestre = function() {
    var period = getPeriod(5010);
    var columns = [];
    columns.push(createColumn('Média', 'M', period));
    columns.push(createColumn('Faltas', 'F', period));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 2, 2, 1, columns));
};

var setAtualidade = function() {
    var period = {};
    var columns = [];
    //columns.push(createColumn('', 'M', period));
    data.periodos.push(createPeriod(0, 'Atualidades', 3, 0, 1, columns));
};

var setPrimeiroTrimestre = function() {
    var period = getPeriod(6252);
    var columns = [];
    columns.push(createColumn('Média', 'M', period, calculoPrimeiroSemestreAnterior));
    columns.push(createColumn('Recuperação Semestral', 'M', period));
    columns.push(createColumn('Média', 'M', period, calculoPrimeiroSemestreDefinitiva));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 4, 0, 1, columns));
};

var setTerceiroBimestre = function() {
    var period = getPeriod(5011);
    var columns = [];
    columns.push(createColumn('Média', 'M', period));
    columns.push(createColumn('Faltas', 'F', period));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 5, 3, 2, columns));
};

var setQuartoBimestre = function() {
    var period = getPeriod(5012);
    var columns = [];
    columns.push(createColumn('Média', 'M', period));
    columns.push(createColumn('Faltas', 'F', period));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 6, 4, 2, columns));
};

var setMediaAnual = function() {
    var period = data.enrollments[0].averageDefinitions[0];
    var columns = [];
    columns.push(createColumn('Média', 'M', period, calculoAnualAnterior));
    columns.push(createColumn('Prova Final', 'M', period));
    columns.push(createColumn('Média','M', period, calculoAnualDefinitiva));
    data.periodos.push(createPeriod(0, period.name, 7, 0, 0, columns));
};

var setMediaFinal = function() {
    var period = getPeriod(6253);
    var columns = [];
    columns.push(createColumn('Média', 'M', period, calculoFinalAnterior));
    columns.push(createColumn('Recuperação Final', 'M', period));
    columns.push(createColumn('Média', 'M', period, calculoFinalDefinitiva));
    data.periodos.push(createPeriod(period.idPeriod, 'Média Final', 8, 0, 0, columns));
};

var getPeriod = function(idPeriod) {
    var periodSelected = {};
    data.enrollments[0].periods.forEach(function(period) {
        if(period.idPeriod === idPeriod) { periodSelected = period };
    });
    return periodSelected;
};

var createPeriod = function(idPeriod, name, id, bimestre, semestre, columns) {
    var group = !columns.length ? 2 : 1;
    return { 'idPeriod': idPeriod, 'name': name, 'id': id, 'bimestre': bimestre, 'trimestre': semestre, 'columns': columns, 'group': group }
};

var getSubject = function(idPeriod) {
    var subjectSelected = {};
    return subjectSelected;
};

var createColumn = function(name, type, period, callback) {
    return { 'name': name, 'type': type, 'value': null, 'period': period, 'callback': callback };
    //return { 'name': name, 'type': type, 'value': Math.random() * 10, 'period': period };
}

var setSubtitleColumn = function() {
    data.sutitleColumn = [];
    data.periodos.forEach(function(period) {
        period.columns.forEach(function(column) {
            data.sutitleColumn.push(column)
        });
    });
};

var calculoPrimeiroSemestreAnterior = function(subject) {
    var primeiroBimestre = subject.columns[0];
    var segundoBimestre = subject.columns[2];
    if(!primeiroBimestre.value || !segundoBimestre.value) return null;
    var media = 0;
    if(primeiroBimestre.type === 'M') { media += primeiroBimestre.value; }
    if(segundoBimestre.type === 'M') { media += segundoBimestre.value; }
    return media / 2;
};

var calculoPrimeiroSemestreDefinitiva = function(subject) {
    var mediaAnterior = subject.columns[4];
    var mediaSemestre = subject.columns[5];
    if(!mediaAnterior.value || !mediaSemestre.value) return null;
    var media = 0;
    if(mediaAnterior.value >= mediaSemestre.value) { media = mediaAnterior.value; }
    else { 
        if(mediaSemestre.value >= 7) { media = 7; }
        else { media = mediaSemestre.value; }
    }
    return media;
};

var calculoAnualAnterior = function(subject) {
    var primeiroSemestre = subject.columns[6];
    var terceiroBimestre = subject.columns[7];
    var quartoBimestre = subject.columns[9];
    if(!primeiroSemestre.value || !terceiroBimestre.value || !quartoBimestre.value) return null;
    var media = 0;
    if(primeiroSemestre.type === 'M') { media += primeiroSemestre.value * 2; }
    if(terceiroBimestre.type === 'M') { media += terceiroBimestre.value; }
    if(quartoBimestre.type === 'M') { media += quartoBimestre.value; }
    return media / 4;
};

var calculoAnualDefinitiva = function(subject) {
    var mediaAnterior = subject.columns[11];
    var mediaAnual = subject.columns[12];
    if(!mediaAnterior.value || !mediaAnual.value) return null;
    var media = 0;
    if(mediaAnterior.value >= mediaAnual.value) { media = mediaAnterior.value; }
    else { 
        if(mediaAnual.value >= 7) { media = 7; }
        else { media = mediaAnual.value; }
    }
    return media;
};

var calculoFinalAnterior = function(subject) {
    var mediaAnual = subject.columns[13];
    if(!mediaAnual.value) return null;
    return mediaAnual.value;
};

var calculoFinalDefinitiva = function(subject) {
    var mediaAnterior = subject.columns[14];
    var mediaFinal = subject.columns[15];
    if(!mediaAnterior.value || !mediaFinal.value) return null;
    var media = 0;
    if(mediaAnterior.value >= mediaFinal.value) { media = mediaAnterior.value; }
    else { 
        if(mediaFinal.value >= 7) { media = 7; }
        else { media = mediaFinal.value; }
    }
    return media;
};

var setMedia = function(column, subject, periodo) {
    if(column.type === 'M') { 
        if(column.callback) { 
            column.value = column.callback(subject); 
        } else {
            var average = subject.periodAverages[periodo.idPeriod];
            if(average && average.value) { column.value = average.value; }
            //else { column.value = Math.ceil(Math.random() * 10); }
        }
    }  
};

var setFrequencia = function(column, subject, periodo) {
    if(column.type === 'F') { 
        var attendance = subject.attendance[periodo.idPeriod];
        if(attendance) { column.value = attendance.absence; }
        //else { column.value = Math.floor(Math.random() * 10); }
    }
};

var report = function() {
    data.enrollments.forEach(function(enrollment) {
        enrollment.subjects.forEach(function(subject) {
            subject.columns = [];
            showDisciplina(subject);
            data.periodos.forEach(function(periodo) {
                if(!periodo.columns || !periodo.columns.length) {
                    var column = createColumn('', '', periodo);
                    setColumnSubject(column, subject, periodo);
                } else {
                    periodo.columns.forEach(function(column, indexColumn) {
                        setColumnSubject(column, subject, periodo);
                        calculoEnsinoFundamental(subject, enrollment, indexColumn);
                        calculoEnsinoMedio(subject, enrollment, indexColumn);
                    });
                }    
            });
        });
    });
};

var showDisciplina = function(subject) {
    var show = true;
    
    // EF II
    
    // Gramatica
    if(diciplinasRules.gramaticaEF.includes(subject.idSubject)) { show = false; }
    // Redação
    if(diciplinasRules.redacaoEF.includes(subject.idSubject)) { show = false; }
    // Algebra
    if(diciplinasRules.algebraEF.includes(subject.idSubject)) { show = false; }
    // Geometria
    if(diciplinasRules.geometriaEF.includes(subject.idSubject)) { show = false; }
    // Biologia/Quimica
    if(diciplinasRules.biologiaQuimicaEF.includes(subject.idSubject)) { show = false; }
    // Fisica
    if(diciplinasRules.fisicaEF.includes(subject.idSubject)) { show = false; }
    // Leitura
    if(diciplinasRules.leituraEF.includes(subject.idSubject)) { show = false; }
    
    // EM
    
    // Gramatica
    if(diciplinasRules.gramaticaEM.includes(subject.idSubject)) { show = false; }
    // Redação
    if(diciplinasRules.redacaoEM.includes(subject.idSubject)) { show = false; }
    // Matematica I
    if(diciplinasRules.matematicaIEM.includes(subject.idSubject)) { show = false; }
    // Matemática II
    if(diciplinasRules.matematicaIIEM.includes(subject.idSubject)) { show = false; }
    // Biologia I
    if(diciplinasRules.biologiaIEM.includes(subject.idSubject)) { show = false; }
    // Biologia II
    if(diciplinasRules.biologiaIIEM.includes(subject.idSubject)) { show = false; }
    // Quimica I
    if(diciplinasRules.quimicaIEM.includes(subject.idSubject)) { show = false; }
    // Quimica II
    if(diciplinasRules.quimicaIIEM.includes(subject.idSubject)) { show = false; }
    // Fisica I
    if(diciplinasRules.fisicaIEM.includes(subject.idSubject)) { show = false; }
    // Fisica II
    if(diciplinasRules.fisicaIIEM.includes(subject.idSubject)) { show = false; }
    
    subject.show = show;
}

var setColumnSubject = function(column, subject, periodo) {
    var columnSubject = angular.copy(column);
    setMedia(columnSubject, subject, periodo);
    setFrequencia(columnSubject, subject, periodo);
    subject.columns.push(columnSubject);
};


// Calculos temporarios com valores fixos

// Ensino Fundamental

var calculoEnsinoFundamental = function(subject, enrollment, idColumn) {
    calculoLinguaPortuguesaEnsinoFundamental(subject, enrollment, idColumn);
    calculoMatematicaEnsinoFundamental(subject, enrollment, idColumn);
    calculoCienciasEnsinoFundamental(subject, enrollment, idColumn);
};

// 6 | 7 | 8 | 9
var calculoLinguaPortuguesaEnsinoFundamental = function(subject, enrollment, idColumn) {
    if(!diciplinasRules.linguaPortuguesaEF.includes(subject.idSubject)) return;
    var gramatica = getDisciplina(enrollment.subjects, diciplinasRules.gramaticaEF);
    var redacao = getDisciplina(enrollment.subjects, diciplinasRules.redacaoEF);
    if(subject.columns[idColumn].type === 'M') {
        subject.columns[idColumn].value = (gramatica.columns[idColumn].value + redacao.columns[idColumn].value) / 2;
    } else if(subject.columns[idColumn].type === 'F') {
        subject.columns[idColumn].value = (gramatica.columns[idColumn].value + redacao.columns[idColumn].value);
    }
};

// 8 | 9
var calculoMatematicaEnsinoFundamental = function(subject, enrollment, idColumn) {
    if(!diciplinasRules.matematicaEF.includes(subject.idSubject)) return;
    var algebra = getDisciplina(enrollment.subjects, diciplinasRules.algebraEF);
    var geometria = getDisciplina(enrollment.subjects, diciplinasRules.geometriaEF);
    if(subject.columns[idColumn].type === 'M') {
        subject.columns[idColumn].value = (algebra.columns[idColumn].value + geometria.columns[idColumn].value) / 2;
    } else if(subject.columns[idColumn].type === 'F') {
        subject.columns[idColumn].value = (algebra.columns[idColumn].value + geometria.columns[idColumn].value);
    }    
};

// 9
var calculoCienciasEnsinoFundamental = function(subject, enrollment, idColumn) {
    if(!diciplinasRules.cienciasEF.includes(subject.idSubject)) return;
    var bioQuim = getDisciplina(enrollment.subjects, diciplinasRules.biologiaQuimicaEF);
    var fisica = getDisciplina(enrollment.subjects, diciplinasRules.fisicaEF);
    if(subject.columns[idColumn].type === 'M') {
        subject.columns[idColumn].value = (bioQuim.columns[idColumn].value + fisica.columns[idColumn].value) / 2;
    } else if(subject.columns[idColumn].type === 'F') {
        subject.columns[idColumn].value = (bioQuim.columns[idColumn].value + fisica.columns[idColumn].value);
    }    
};

// Ensino Médio

var calculoEnsinoMedio = function(subject, enrollment, idColumn) {
    calculoLinguaPortuguesaEnsinoMedio(subject, enrollment, idColumn);
    calculoMatematicaEnsinoMedio(subject, enrollment, idColumn);
    calculoBiologiaEnsinoMedio(subject, enrollment, idColumn);
    calculoQuimicaEnsinoMedio(subject, enrollment, idColumn);
    calculoFisicaEnsinoMedio(subject, enrollment, idColumn);
};

// 1 | 2 | 3
var calculoLinguaPortuguesaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(!diciplinasRules.linguaPortuguesaEM.includes(subject.idSubject)) return;
    var gramatica = getDisciplina(enrollment.subjects, diciplinasRules.gramaticaEM);
    var redacao = getDisciplina(enrollment.subjects, diciplinasRules.redacaoEM);
    if(subject.columns[idColumn].type === 'M') {
        subject.columns[idColumn].value = (gramatica.columns[idColumn].value + redacao.columns[idColumn].value) / 2;
    } else if(subject.columns[idColumn].type === 'F') {
        subject.columns[idColumn].value = (gramatica.columns[idColumn].value + redacao.columns[idColumn].value);
    }    
    
};

// 1 | 2 | 3
var calculoMatematicaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(!diciplinasRules.matematicaEM.includes(subject.idSubject)) return;
    var matematica1 = getDisciplina(enrollment.subjects, diciplinasRules.matematicaIEM);
    var matematica2 = getDisciplina(enrollment.subjects, diciplinasRules.matematicaIIEM);
    if(subject.columns[idColumn].type === 'M') {
        subject.columns[idColumn].value = (matematica1.columns[idColumn].value + matematica2.columns[idColumn].value) / 2;
    } else if(subject.columns[idColumn].type === 'F') {
        subject.columns[idColumn].value = (matematica1.columns[idColumn].value + matematica2.columns[idColumn].value);
    }    
    
};

// 1 | 2 | 3
var calculoBiologiaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(!diciplinasRules.biologiaEM.includes(subject.idSubject)) return;
    var biologia1 = getDisciplina(enrollment.subjects, diciplinasRules.biologiaIEM);
    var biologia2 = getDisciplina(enrollment.subjects, diciplinasRules.biologiaIIEM);
    if(subject.columns[idColumn].type === 'M') {
        subject.columns[idColumn].value = (biologia1.columns[idColumn].value + biologia2.columns[idColumn].value) / 2;
    } else if(subject.columns[idColumn].type === 'F') {
        subject.columns[idColumn].value = (biologia1.columns[idColumn].value + biologia2.columns[idColumn].value);
    }     
};

// 1 | 2 | 3
var calculoQuimicaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(!diciplinasRules.quimicaEM.includes(subject.idSubject)) return;
    var quimica1 = getDisciplina(enrollment.subjects, diciplinasRules.quimicaIEM);
    var quimica2 = getDisciplina(enrollment.subjects, diciplinasRules.quimicaIIEM);
    if(subject.columns[idColumn].type === 'M') {
        subject.columns[idColumn].value = (quimica1.columns[idColumn].value + quimica2.columns[idColumn].value) / 2;
    } else if(subject.columns[idColumn].type === 'F') {
        subject.columns[idColumn].value = (quimica1.columns[idColumn].value + quimica2.columns[idColumn].value);
    }     
};

// 1 | 2 | 3
var calculoFisicaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(!diciplinasRules.fisicaEM.includes(subject.idSubject)) return;
    var fisica1 = getDisciplina(enrollment.subjects, diciplinasRules.fisicaIEM);
    var fisica2 = getDisciplina(enrollment.subjects, diciplinasRules.fisicaIIEM);
    if(subject.columns[idColumn].type === 'M') {
        subject.columns[idColumn].value = (fisica1.columns[idColumn].value + fisica2.columns[idColumn].value) / 2;
    } else if(subject.columns[idColumn].type === 'F') {
        subject.columns[idColumn].value = (fisica1.columns[idColumn].value + fisica2.columns[idColumn].value);
    }     
};

var getDisciplina = function(subjects, idDisciplina) {
    var disciplina;
    subjects.forEach(function(subject) {
        if(idDisciplina.includes(subject.idSubject)) {
            disciplina = subject;
        } 
    });
    return disciplina;
};

init();

console.log(data);
return data;