var init = function() {
    setPeriods();
    report();
};

var setPeriods = function() {
    data.periodos = [];
    setPrimeiroBimestre();
    setSegundoBimestre();
    setAtualidade();
    setPrimeiroTrimestre();
    setTerceiroBimestre();
    setQuartoBimestre();
    setMediaAnual();
    setMediaFinal();
    setSubtitleColumn();
};

var setPrimeiroBimestre = function() {
    var period = getPeriod(4537);
    var columns = [];
    columns.push(createColumn('Média', 'M', period));
    columns.push(createColumn('Faltas', 'F', period));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 1, 1, 1, columns));
};

var setSegundoBimestre = function() {
    var period = getPeriod(5010);
    var columns = [];
    columns.push(createColumn('Média', 'M', period));
    columns.push(createColumn('Faltas', 'F', period));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 2, 2, 1, columns));
};

var setAtualidade = function() {
    var period = {};
    var columns = [];
    //columns.push(createColumn('', 'M', period));
    data.periodos.push(createPeriod(0, 'Atualidades', 3, 0, 1, columns));
};

var setPrimeiroTrimestre = function() {
    var period = getPeriod(6252);
    var columns = [];
    columns.push(createColumn('Média', 'M', period, calculoMediaPrimeiroSemestreAnterior));
    columns.push(createColumn('Recuperação Semestral', 'M', period));
    columns.push(createColumn('Média', 'M', period, calculoMediaPrimeiroSemestreDefinitiva));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 4, 0, 1, columns));
};

var setTerceiroBimestre = function() {
    var period = getPeriod(5011);
    var columns = [];
    columns.push(createColumn('Média', 'M', period));
    columns.push(createColumn('Faltas', 'F', period));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 5, 3, 2, columns));
};

var setQuartoBimestre = function() {
    var period = getPeriod(5012);
    var columns = [];
    columns.push(createColumn('Média', 'M', period));
    columns.push(createColumn('Faltas', 'F', period));
    data.periodos.push(createPeriod(period.idPeriod, period.name, 6, 4, 2, columns));
};

var setMediaAnual = function() {
    var period = data.enrollments[0].averageDefinitions[0];
    var columns = [];
    columns.push(createColumn('Média', 'M', period, calculoMediaAnualAnterior));
    columns.push(createColumn('Prova Final', 'M', period));
    columns.push(createColumn('Média','M', period, calculoMediaAnualDefinitiva));
    data.periodos.push(createPeriod(0, period.name, 7, 0, 0, columns));
};

var setMediaFinal = function() {
    var period = getPeriod(6253);
    var columns = [];
    columns.push(createColumn('Média', 'M', period, calculoMediaFinalAnterior));
    columns.push(createColumn('Recuperação Final', 'M', period));
    columns.push(createColumn('Média', 'M', period, calculoMediaFinalDefinitiva));
    data.periodos.push(createPeriod(period.idPeriod, 'Média Final', 8, 0, 0, columns));
};

var getPeriod = function(idPeriod) {
    var periodSelected = {};
    data.enrollments[0].periods.forEach(function(period) {
        if(period.idPeriod === idPeriod) { periodSelected = period };
    });
    return periodSelected;
};

var createPeriod = function(idPeriod, name, id, bimestre, semestre, columns) {
    var group = !columns.length ? 2 : 1;
    return { 'idPeriod': idPeriod, 'name': name, 'id': id, 'bimestre': bimestre, 'trimestre': semestre, 'columns': columns, 'group': group }
};

var getSubject = function(idPeriod) {
    var subjectSelected = {};
    return subjectSelected;
};

var createColumn = function(name, type, period, callback) {
    return { 'name': name, 'type': type, 'value': null, 'period': period, 'callback': callback };
    //return { 'name': name, 'type': type, 'value': Math.random() * 10, 'period': period };
}

var setSubtitleColumn = function() {
    data.sutitleColumn = [];
    data.periodos.forEach(function(period) {
        period.columns.forEach(function(column) {
            data.sutitleColumn.push(column)
        });
    });
};

var calculoMediaPrimeiroSemestreAnterior = function(subject) {
    var primeiroBimestre = subject.columns[0];
    var segundoBimestre = subject.columns[2];
    if(!primeiroBimestre.value || !segundoBimestre.value) return null;
    var media = 0;
    if(primeiroBimestre.type === 'M') { media += primeiroBimestre.value; }
    if(segundoBimestre.type === 'M') { media += segundoBimestre.value; }
    return media / 2;
};

var calculoMediaPrimeiroSemestreDefinitiva = function(subject) {
    var mediaAnterior = subject.columns[4];
    var mediaSemestre = subject.columns[5];
    if(!mediaAnterior.value || !mediaSemestre.value) return null;
    var media = 0;
    if(mediaAnterior.value >= mediaSemestre.value) { media = mediaAnterior.value; }
    else { 
        if(mediaSemestre.value >= 7) { media = 7; }
        else { media = mediaSemestre.value; }
    }
    return media;
};

var calculoMediaAnualAnterior = function(subject) {
    var primeiroSemestre = subject.columns[6];
    var terceiroBimestre = subject.columns[7];
    var quartoBimestre = subject.columns[9];
    if(!primeiroSemestre.value || !terceiroBimestre.value || !quartoBimestre.value) return null;
    var media = 0;
    if(primeiroSemestre.type === 'M') { media += primeiroSemestre.value * 2; }
    if(terceiroBimestre.type === 'M') { media += terceiroBimestre.value; }
    if(quartoBimestre.type === 'M') { media += quartoBimestre.value; }
    return media / 4;
};

var calculoMediaAnualDefinitiva = function(subject) {
    var mediaAnterior = subject.columns[11];
    var mediaAnual = subject.columns[12];
    if(!mediaAnterior.value || !mediaAnual.value) return null;
    var media = 0;
    if(mediaAnterior.value >= mediaAnual.value) { media = mediaAnterior.value; }
    else { 
        if(mediaAnual.value >= 7) { media = 7; }
        else { media = mediaAnual.value; }
    }
    return media;
};

var calculoMediaFinalAnterior = function(subject) {
    var mediaAnual = subject.columns[13];
    if(!mediaAnual.value) return null;
    return mediaAnual.value;
};

var calculoMediaFinalDefinitiva = function(subject) {
    var mediaAnterior = subject.columns[14];
    var mediaFinal = subject.columns[15];
    if(!mediaAnterior.value || !mediaFinal.value) return null;
    var media = 0;
    if(mediaAnterior.value >= mediaFinal.value) { media = mediaAnterior.value; }
    else { 
        if(mediaFinal.value >= 7) { media = 7; }
        else { media = mediaFinal.value; }
    }
    return media;
};

var setMedia = function(column, subject, periodo) {
    if(column.type === 'M') { 
        if(column.callback) { 
            column.value = column.callback(subject); 
        } else {
            var average = subject.periodAverages[periodo.idPeriod];
            if(average && average.value) { column.value = average.value; }
            //else { column.value = Math.ceil(Math.random() * 10); }
        }
    }  
};

var setFrequencia = function(column, subject, periodo) {
    if(column.type === 'F') { 
        var attendance = subject.attendance[periodo.idPeriod];
        if(attendance) { column.value = attendance.absence; }
        //else { column.value = Math.floor(Math.random() * 10); }
    }
};

var report = function() {
    data.enrollments.forEach(function(enrollment) {
        enrollment.subjects.forEach(function(subject) {
            subject.columns = [];
            showDisciplina(subject);
            data.periodos.forEach(function(periodo) {
                if(!periodo.columns || !periodo.columns.length) {
                    var column = createColumn('', '', periodo);
                    setColumnSubject(column, subject, periodo);
                } else {
                    periodo.columns.forEach(function(column, indexColumn) {
                        setColumnSubject(column, subject, periodo);
                        calculoMediaEnsinoFundamental(subject, enrollment, indexColumn);
                        calculoMediaEnsinoMedio(subject, enrollment, indexColumn);
                    });
                }    
            });
        });
    });
};

var showDisciplina = function(subject) {
    var show = true;
    
    // EF II
    // Gramatica / Redação
    if(subject.idSubject === 8497) { show = false; }
    if(subject.idSubject === 8493) { show = false; }
    // Algebra / Geometria
    if(subject.idSubject === 8518) { show = false; }
    if(subject.idSubject === 8519) { show = false; }
    // Biologia/Quimica / Fisica
    if(subject.idSubject === 8523) { show = false; }
    if(subject.idSubject === 8526) { show = false; }
    
    // EM
    // Gramatica / Redação
    if(subject.idSubject === 8416) { show = false; }
    if(subject.idSubject === 8417) { show = false; }
    // Matematica I / Matemática II
    if(subject.idSubject === 8321) { show = false; }
    if(subject.idSubject === 8322) { show = false; }
    // Biologia I / Biologia II
    if(subject.idSubject === 8328) { show = false; }
    if(subject.idSubject === 8329) { show = false; }
    // Quimica I / Quimica II
    if(subject.idSubject === 8317) { show = false; }
    if(subject.idSubject === 8318) { show = false; }
    // Fisica I / Fisica II
    if(subject.idSubject === 8319) { show = false; }
    if(subject.idSubject === 8320) { show = false; }
    
    subject.show = show;
}

var setColumnSubject = function(column, subject, periodo) {
    var columnSubject = angular.copy(column);
    setMedia(columnSubject, subject, periodo);
    setFrequencia(columnSubject, subject, periodo);
    subject.columns.push(columnSubject);
};


// Calculos temporarios com valores fixos

// Ensino Fundamental

var calculoMediaEnsinoFundamental = function(subject, enrollment, idColumn) {
    calculoMediaLinguaPortuguesaEnsinoFundamental(subject, enrollment, idColumn);
    calculoMediaMatematicaEnsinoFundamental(subject, enrollment, idColumn);
    calculoMediaCienciasEnsinoFundamental(subject, enrollment, idColumn);
};

var calculoMediaLinguaPortuguesaEnsinoFundamental = function(subject, enrollment, idColumn) {
    if(subject.idSubject !== 15390) return;
    var gramatica = getDisciplina(enrollment.subjects, 8497);
    var redacao = getDisciplina(enrollment.subjects, 8493);
    subject.columns[idColumn].value = (gramatica.columns[idColumn].value + redacao.columns[idColumn].value) / 2;
};

var calculoMediaMatematicaEnsinoFundamental = function(subject, enrollment, idColumn) {
    if(subject.idSubject !== 13151) return;
    var algebra = getDisciplina(enrollment.subjects, 8518);
    var geometria = getDisciplina(enrollment.subjects, 8519);
    subject.columns[idColumn].value = (algebra.columns[idColumn].value + geometria.columns[idColumn].value) / 2;
};

var calculoMediaCienciasEnsinoFundamental = function(subject, enrollment, idColumn) {
    if(subject.idSubject !== 13152) return;
    var bioQuim = getDisciplina(enrollment.subjects, 8523);
    var fisica = getDisciplina(enrollment.subjects, 8526);
    subject.columns[idColumn].value = (bioQuim.columns[idColumn].value + fisica.columns[idColumn].value) / 2;
};

// Ensino Médio

var calculoMediaEnsinoMedio = function(subject, enrollment, idColumn) {
    calculoMediaLinguaPortuguesaEnsinoMedio(subject, enrollment, idColumn);
    calculoMediaMatematicaEnsinoMedio(subject, enrollment, idColumn);
    calculoMediaBiologiaEnsinoMedio(subject, enrollment, idColumn);
    calculoMediaQuimicaEnsinoMedio(subject, enrollment, idColumn);
    calculoMediaFisicaEnsinoMedio(subject, enrollment, idColumn);
};

var calculoMediaLinguaPortuguesaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(subject.idSubject !== 13157) return;
    var gramatica = getDisciplina(enrollment.subjects, 8416);
    var redacao = getDisciplina(enrollment.subjects, 8417);
    subject.columns[idColumn].value = (gramatica.columns[idColumn].value + redacao.columns[idColumn].value) / 2;
};

var calculoMediaMatematicaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(subject.idSubject !== 13153) return;
    var matematica1 = getDisciplina(enrollment.subjects, 8321);
    var matematica2 = getDisciplina(enrollment.subjects, 8322);
    subject.columns[idColumn].value = (matematica1.columns[idColumn].value + matematica2.columns[idColumn].value) / 2;
};

var calculoMediaBiologiaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(subject.idSubject !== 13154) return;
    var biologia1 = getDisciplina(enrollment.subjects, 8328);
    var biologia2 = getDisciplina(enrollment.subjects, 8329);
    subject.columns[idColumn].value = (biologia1.columns[idColumn].value + biologia2.columns[idColumn].value) / 2;
};

var calculoMediaQuimicaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(subject.idSubject !== 13156) return;
    var quimica1 = getDisciplina(enrollment.subjects, 8317);
    var quimica2 = getDisciplina(enrollment.subjects, 8318);
    subject.columns[idColumn].value = (quimica1.columns[idColumn].value + quimica2.columns[idColumn].value) / 2;
};

var calculoMediaFisicaEnsinoMedio = function(subject, enrollment, idColumn) {
    if(subject.idSubject !== 13155) return;
    var fisica1 = getDisciplina(enrollment.subjects, 8319);
    var fisica2 = getDisciplina(enrollment.subjects, 8320);
    subject.columns[idColumn].value = (fisica1.columns[idColumn].value + fisica2.columns[idColumn].value) / 2;
};

var getDisciplina = function(subjects, idDisciplina) {
    var disciplina;
    subjects.forEach(function(subject) {
        if(subject.idSubject === idDisciplina) {
            disciplina = subject;
        } 
    });
    return disciplina;
};

init();

console.log(data);
return data;