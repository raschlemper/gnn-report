var init = function() {
    data.currentDate = new Date();
    data.total = 0;
    data.totalDiscount100 = 0;
    data.totalDiscount50 = 0;
    data.totalPaying = 0;  
    data.round = round;
    report();
};

var round = function(value) {
    return Math.ceil(value);  
};

var possuiBolsaIntegral = function(discount) {
    return (discount.idDiscount === 2939 || discount.idDiscount === 2955 || discount.idDiscount === 2969 || discount.idDiscount === 2979) && discount.percentage === 100;
}

var possuiBolsaParcial = function(discount){
    return (discount.idDiscount === 2940 || discount.idDiscount === 2954 || discount.idDiscount === 2980) && discount.percentage === 50;
};

var setDiscountBolsa = function(enrollment) {
    enrollment.contracts.forEach(function (contract) {
        contract.invoices.forEach(function (invoice) {
            invoice.discounts.forEach(function (discount) {
                if(!enrollment.discount100) { enrollment.discount100 = possuiBolsaIntegral(discount); }
                if(!enrollment.discount50) { enrollment.discount50 = possuiBolsaParcial(discount); }
            });
        });
    });
    
    if(enrollment.discount100) { data.totalDiscount100++; }
    if(enrollment.discount50) { data.totalDiscount50++; }
}

var report = function() {
    
    data.classes.forEach(function(clazz) {

        if(!clazz.quantity) { clazz.quantity = (clazz.enrollments.length); }
        data.total += clazz.quantity;

        clazz.enrollments.forEach(function(enrollment) {
            setDiscountBolsa(enrollment);
            data.totalPaying = (data.total - data.totalDiscount100);
        });

    });
    
    data.minimo5 = data.totalPaying/5;
    data.minimo9 = data.totalPaying/9;

}    

init();

console.log(data);

return data;







